<html>

<head>
<script src="jquery.js"></script>
<script src="markdown.min.js"></script>
</head>

<body>
<div id="top"><span class="numerator"></span>/ <span class="denominator"></span></div>
Here is the iframe <br/>
<!--iframe id="typeform-iframe" src="https://forms.typeform.io/to/5GziGV5QzI6jLA" width="1280" height="1024"></iframe> -->
<iframe id="typeform-iframe" src="test-form.html" width="1280" height="1024"></iframe>
</body>

<style type="text/css">
#top {
	position: fixed;
	top: 0;
	right: 0;
	z-index: 999;
	width: 15%;
	height: 10%;
	font-size: 41pt;
}
</style>



<script type="text/javascript">

var updateNumerator = function(){
 	$("#top > .numerator").text(answers.correct);
 	$("#top > .denominator").text(answers.correct + answers.wrong);
}

var answers = {'correct':0,'wrong':0};
	
	$(document).ready(function(){

		console.log("Ready");

		$("#typeform-iframe")[0].onload = function(){
			//console.log("iframe loaded");

			var answerSize = $("#typeform-iframe").contents().find(".questions").contents().children().size() / 2;
		 	answers.wrong = answerSize;			
		 	updateNumerator();
			//convert question text from markdown to html


			$.merge(
				$("#typeform-iframe").contents().find(".question span")
			,
				$("#typeform-iframe").contents().find(".description")
			).each(function(index, current){

					current = $(current);
					var startText = current.text().substring(0,2);
					var curText = current.text();
					var answer = curText.match(/[0-9]/);

					if(answer !== null){
						curText = current.text().replace(/[0-9];/, "");

						var div = $("<div class='answer'>" + answer + "</div>");
						$(div).hide();

						$(current[0].parentElement).first().append(div);
					}

					current.html(markdown.toHTML(curText));
					
					current.contents().find("code").each(function(index, current){
				 		$(current).css({'font-family': 'Courier, monospace'});
				 	});

			 	});

			$("#typeform-iframe").contents().find(".yes-no li.container").click(function(e){
				//console.log(e);
				var li = e.target.parentElement.parentElement;

				//console.log ("Parent", parent);

				var currentIndex = 0;

				if(li.nextElementSibling === null){
					currentIndex = 1;
				}

				var label = $(".label", parent);

				//console.log("Label text=", label, "index = ", currentIndex);

				//console.log(".answer", li.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement);

				var answerToCurrentQuestion = $(".answer", li.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.nextElementSibling).text();


				var numerator = $("#top > .numerator");
				var currentNumerator = Number(numerator.text());
				
				//important to make it double =, not triple
				if(currentIndex == answerToCurrentQuestion){
					answers.wrong--;
					answers.correct++;
					updateNumerator();
				} else {
					answers.wrong++;
					answers.correct--;
					updateNumerator();
				}

				//console.log("answerToCurrentQuestion", answerToCurrentQuestion);

				//$(".content .control li"
			});
		}

	});

</script>

</html>